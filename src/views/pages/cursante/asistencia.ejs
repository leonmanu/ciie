<!-- Parte de arriba -->
<%- include('../../layout/partTop.ejs') %>
<!-- <script src="/js/estudianteAsignatura.ajax.js"></script> -->
<% let i = 1 %>
      <% let encuentro %>
  <!-- Header -->
  <header class="w3-container w3-bar sticky-top" style="padding-top:22px; align-items: center; background-color: rgba(0, 0, 0, 0.5); /* Fondo semitransparente */">

    <div class="">
      <div class="w3-white w3-large" style="max-width:1200px;margin:auto">
        <div class="w3-right w3-padding-10">
          <button href="#" class="btn_save w3-button w3-teal" row_id="'+row_id+'" disabled>
            <span id="">Guardar</span> 
            <img class="pull-right" id="waitIconAsignatura" src='/img/whiteIconGrisSegmentos.gif' style="display:none;" width="22" height="22" />
          </button>
        </div>
        <div class="w3-left w3-padding-16">
          <i class="fa fa-dashboard"></i> <span id="campoClave">Asistencia: <%= paramCampo %> / Ch: </span>
        </div>
        <div class="w3-left w3-padding-16">
          <select id="cohorteClave" class="row_data w3-border" name="calificacion" col_name = "Valoracion">
            <option value="seleccione"  style="display:none"> seleccione </option>
            <% cohortes.forEach(function(cohorte){ %>
              <% let selected %>
              <% if(cohorte['clave'] == cohorteUltima.clave) { %>
                <% selected = "selected" %>
              <% }%>
              <option <%= selected %> value="<%= cohorte.clave %>"><%= cohorte.clave %></option>
            <% }) %>
          </select>
          <img class="pull-right" id="waitIconAsignatura3" src='/img/whiteIconGrisSegmentos.gif' style="display:none;" width="22" height="22" />
        </div>
      </div>
    </div>
    
  </header>

  <div id="modalFechaEcuentros" class="w3-modal modal">
    <div class="w3-modal-content">        
          <div>
            <% include ./fechaEncuentros_form.ejs %>
          </div>
    </div>
  </div>

  <div class="w3-container">
    <table class="w3-table-all">
      <thead>
        <tr class="w3-light-grey" style="border: 1px solid #ddd;">
          <th rowspan="2" style="text-align: center; vertical-align: middle; border: 1px solid #ddd;">
            Cursante (<span id="spnNroCursantes"><%= cursantes.length %></span>) <button id="copyEmailsBtn" class="w3-button w3-teal"><b>@</b></button>
          </th>
          <th rowspan="2" style="text-align: center; vertical-align: middle; border: 1px solid #ddd;">DNI</th>
          <th class="ocultable" colspan="5" style="text-align: center; vertical-align: middle; border: 1px solid #ddd;">Encuentros
            <button id="btnFechaEncuentros" href="#" class="w3-button w3-teal">
                <i class="fa fa-calendar" aria-hidden="true"></i>
                <img class="pull-right" id="waitIconFecha" src='/img/whiteIconGrisSegmentos.gif' style="display:none ;" width="22" height="22" />
          </button></th>
          <th class="ocultable" rowspan="2" style="text-align: center; vertical-align: middle; border: 1px solid #ddd;">Valoración</th>
        </tr>
        <tr class="w3-light-grey" style="border: 1px solid #ddd;">
          <% for(var j=1; j<=5; j++) { %>
            <% encuentro ='encuentro'+j %>
            <% let fechaSubstring = (encuentroFecha && [encuentro] !== undefined && encuentroFecha[encuentro] !== '') ? String(encuentroFecha[encuentro]).substring(8,10) + "-" + String(encuentroFecha[encuentro]).substring(5,7)  : '' %>
            <th class="encuentro ocultable" style="text-align: center; vertical-align: middle; border: 1px solid #ddd;"><%= j %>° : <%= fechaSubstring %></th>
          <% } %>
        </tr>
      </thead>
      
      <% cursantes.forEach(function(registro){ %>
        <tr  rowNumber='<%= registro._rowNumber %>' >
          <td class="modified" style="display:none ;" col_name="change">
            false
          </td>
          <td> 
           <%= i %> | <%= registro['Apellido/s'] %>,  <%= registro['Nombre/s'] %>
          </td>
          <td>
            <%= registro['Número de DNI'] %>
          </td>
          <% for(var j=1; j<=5; j++) {%>
            <% encuentro = 'encuentro'+j %>
            <td class="ocultable" style="text-align: center; vertical-align: middle;" >
              
              <% if(registro[encuentro] == 'TRUE'){ %>
                <button class="row_data btnChange w3-button w3-border w3-border-indigo" col_name = "<%= encuentro %>"><strong>Presente</strong></button>
              <% } else { %>
                <button class="row_data btnChange w3-button w3-border w3-border-red" col_name = "<%= encuentro %>">Ausente</button>
              <% } %>
              
            </td>
         <% } %>
         <td class="ocultable" >
          <select class="row_data w3-select  w3-border w3-leftbar slcChange" name="calificacion" col_name = "Valoracion">
            <option value="seleccione"  style="display:none"> seleccione </option>
            <% calificaciones.forEach(function(calificacion){ %>
              <% let selected %>
              <% if(registro['Valoracion'] == calificacion.nombre) { %>
                <% selected = "selected" %>
              <% }%>
              <option <%= selected %> value="<%= calificacion.nombre %>"><%= calificacion.nombre %></option>
            <% }) %>
          </select>
        </td>
        <td class="modified" style="display:none ;">
          <%= i %> | <%= registro['Seleccione su/s curso/s'] %> %>
         </td>
         <td class="modified" style="display:none ;"><%= registro['Dirección de correo electrónico'] %></td>
        </tr>
        <% i++ %>
        <% }) %>
    </table>
  </div>

 
  <style>
    .sticky-top {
      position: sticky;
      top: 20px;
      z-index: 1000;
    }
    .ocultable {
      display: none;
    }
  </style>

  <script>
 
</script>

  <!-- Parte de abajo -->
  <%- include('../../layout/partBotton.ejs') %>
 
